<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:color="http://www.omg.org/spec/BPMN/non-normative/color/1.0" xmlns:modeler="http://camunda.org/schema/modeler/1.0" id="Definitions_1e9gp8v" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.37.0" modeler:executionPlatform="Camunda Platform" modeler:executionPlatformVersion="7.20.0">
  <bpmn:process id="community_audit" name="Community Audit" isExecutable="true">
    <bpmn:documentation>{
        "description": "Community Analytics and Insights",
        "img_picture": "https://assets-stage.dex.guru/icons/skull.svg",
        "type": "agent_restart",
        "reward": 0.0
}</bpmn:documentation>
    <bpmn:endEvent id="Event_1xbhwog">
      <bpmn:incoming>duplicate_in_runtime</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="Gateway_1cx0ipf" camunda:asyncBefore="true" default="Flow_1dhoqim">
      <bpmn:incoming>Flow_1tqhxeb</bpmn:incoming>
      <bpmn:outgoing>Flow_1dhoqim</bpmn:outgoing>
      <bpmn:outgoing>duplicate_in_runtime</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="Flow_1dhoqim" sourceRef="Gateway_1cx0ipf" targetRef="Activity_1mskwvz" />
    <bpmn:sequenceFlow id="duplicate_in_runtime" name="Exit if duplicate with Business key already exists in Runtime" sourceRef="Gateway_1cx0ipf" targetRef="Event_1xbhwog">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">${isDuplicate}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:serviceTask id="Activity_0fwk1pl" name="ProcessInstanceDeduplicationFlagDelegate" camunda:asyncBefore="true" camunda:class="ai.hhrdr.chainflow.engine.delegate.ProcessInstanceDeduplicationFlagDelegate">
      <bpmn:incoming>Flow_0te82t4</bpmn:incoming>
      <bpmn:outgoing>Flow_1tqhxeb</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:sequenceFlow id="Flow_1tqhxeb" sourceRef="Activity_0fwk1pl" targetRef="Gateway_1cx0ipf" />
    <bpmn:startEvent id="Event_0bayn2k" name="Start" camunda:formRef="community_audit_upload_1" camunda:formRefBinding="latest" camunda:initiator="camunda_user_id">
      <bpmn:extensionElements>
        <camunda:executionListener class="ai.hhrdr.chainflow.engine.listener.SetStartVariablesListener" event="start" />
      </bpmn:extensionElements>
      <bpmn:outgoing>Flow_0te82t4</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="Flow_0te82t4" sourceRef="Event_0bayn2k" targetRef="Activity_0fwk1pl" />
    <bpmn:serviceTask id="Activity_1mskwvz" name="Get User Info" camunda:asyncBefore="true" camunda:class="ai.hhrdr.chainflow.engine.delegate.GetUserInfoDelegate">
      <bpmn:incoming>Flow_1dhoqim</bpmn:incoming>
      <bpmn:outgoing>Flow_00bcz3a</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="Activity_0ywk3w2" name="Export &#38; Upload Chat History" camunda:formRef="community_audit_analysis_2" camunda:formRefBinding="latest" camunda:assignee="${camunda_user_id}">
      <bpmn:documentation>Export your group chat in JSON format from Telegram Desktop and upload it here. We’ll handle the rest.</bpmn:documentation>
      <bpmn:extensionElements />
      <bpmn:incoming>Flow_00bcz3a</bpmn:incoming>
      <bpmn:outgoing>Flow_0f2sgk1</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_00bcz3a" sourceRef="Activity_1mskwvz" targetRef="Activity_0ywk3w2" />
    <bpmn:serviceTask id="Activity_029j5kq" name="File received – analyzing your community now…" camunda:type="external" camunda:topic="telegram_history_rag_import">
      <bpmn:extensionElements>
        <camunda:inputOutput>
          <camunda:inputParameter name="file_url">${s3_chatHistory}</camunda:inputParameter>
          <camunda:inputParameter name="command">process_telegram_rag</camunda:inputParameter>
        </camunda:inputOutput>
      </bpmn:extensionElements>
      <bpmn:incoming>Flow_0f2sgk1</bpmn:incoming>
      <bpmn:outgoing>Flow_0w0aced</bpmn:outgoing>
    </bpmn:serviceTask>
    <bpmn:userTask id="Activity_0l9ozq4" name="ВПотоке Репорт готов!" camunda:formRef="community_audit_results_3" camunda:formRefBinding="latest" camunda:assignee="${camunda_user_id}">
      <bpmn:documentation>Результаты анализа</bpmn:documentation>
      <bpmn:extensionElements />
      <bpmn:incoming>Flow_0w0aced</bpmn:incoming>
      <bpmn:outgoing>Flow_0e6m2ci</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:endEvent id="Event_0cv0wbf">
      <bpmn:incoming>Flow_1uxp8zv</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="Flow_0e6m2ci" sourceRef="Activity_0l9ozq4" targetRef="Activity_1e68jzl" />
    <bpmn:sequenceFlow id="Flow_0f2sgk1" sourceRef="Activity_0ywk3w2" targetRef="Activity_029j5kq" />
    <bpmn:userTask id="Activity_1e68jzl" name="Настройка постоянной аналитики" camunda:formRef="community_audit_bot_4" camunda:formRefBinding="latest" camunda:assignee="${camunda_user_id}">
      <bpmn:documentation>Добавление бота</bpmn:documentation>
      <bpmn:incoming>Flow_0e6m2ci</bpmn:incoming>
      <bpmn:outgoing>Flow_1mxf3o3</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_1mxf3o3" sourceRef="Activity_1e68jzl" targetRef="Activity_0kvttok" />
    <bpmn:userTask id="Activity_0kvttok" name="Максимальный потенциал сообщества" camunda:formRef="community_audit_app_5" camunda:formRefBinding="latest" camunda:assignee="${camunda_user_id}">
      <bpmn:documentation>Создание Приложения Сообщества</bpmn:documentation>
      <bpmn:incoming>Flow_1mxf3o3</bpmn:incoming>
      <bpmn:outgoing>Flow_1uxp8zv</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:sequenceFlow id="Flow_1uxp8zv" sourceRef="Activity_0kvttok" targetRef="Event_0cv0wbf" />
    <bpmn:sequenceFlow id="Flow_0w0aced" sourceRef="Activity_029j5kq" targetRef="Activity_0l9ozq4" />
  </bpmn:process>
  <bpmn:error id="Error_1slv2me" name="Error_1m0iqcr" errorCode="UPDATE_KB_FAIL" />
  <bpmn:message id="Message_39l3bj5" name="embed_kb" />
  <bpmn:message id="Message_3up3j7j" name="MESSAGE_CHATBOT" />
  <bpmn:signal id="Signal_3qfb79c" name="user_updated" />
  <bpmn:message id="Message_0lrohl9" name="CHATBOT_PROVISIONED" />
  <bpmn:message id="Message_1s4c5lk" name="QUEST_FINISH" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="community_audit">
      <bpmndi:BPMNShape id="Event_1xbhwog_di" bpmnElement="Event_1xbhwog">
        <dc:Bounds x="472" y="332" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Gateway_1cx0ipf_di" bpmnElement="Gateway_1cx0ipf" isMarkerVisible="true">
        <dc:Bounds x="415" y="95" width="50" height="50" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0y5gixc" bpmnElement="Activity_0fwk1pl">
        <dc:Bounds x="280" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1lo01gd" bpmnElement="Event_0bayn2k">
        <dc:Bounds x="152" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="160" y="145" width="24" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0nexkt6" bpmnElement="Activity_1mskwvz" color:background-color="" color:border-color="">
        <dc:Bounds x="520" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1boapzz" bpmnElement="Activity_0ywk3w2">
        <dc:Bounds x="660" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Event_0cv0wbf_di" bpmnElement="Event_0cv0wbf">
        <dc:Bounds x="1582" y="102" width="36" height="36" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1se5p8f" bpmnElement="Activity_1e68jzl">
        <dc:Bounds x="1240" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_1drci5w" bpmnElement="Activity_0kvttok">
        <dc:Bounds x="1360" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BPMNShape_0976kxu" bpmnElement="Activity_0l9ozq4">
        <dc:Bounds x="1040" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="Activity_14fiuv3_di" bpmnElement="Activity_029j5kq">
        <dc:Bounds x="840" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="Flow_07nzqai_di" bpmnElement="duplicate_in_runtime">
        <di:waypoint x="440" y="145" />
        <di:waypoint x="440" y="350" />
        <di:waypoint x="472" y="350" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="406" y="277" width="88" height="53" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1tqhxeb_di" bpmnElement="Flow_1tqhxeb">
        <di:waypoint x="380" y="120" />
        <di:waypoint x="415" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1dhoqim_di" bpmnElement="Flow_1dhoqim">
        <di:waypoint x="465" y="120" />
        <di:waypoint x="520" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0te82t4_di" bpmnElement="Flow_0te82t4">
        <di:waypoint x="188" y="120" />
        <di:waypoint x="280" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_00bcz3a_di" bpmnElement="Flow_00bcz3a">
        <di:waypoint x="620" y="120" />
        <di:waypoint x="660" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0f2sgk1_di" bpmnElement="Flow_0f2sgk1">
        <di:waypoint x="760" y="120" />
        <di:waypoint x="840" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1uxp8zv_di" bpmnElement="Flow_1uxp8zv">
        <di:waypoint x="1460" y="120" />
        <di:waypoint x="1582" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0e6m2ci_di" bpmnElement="Flow_0e6m2ci">
        <di:waypoint x="1140" y="120" />
        <di:waypoint x="1240" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_1mxf3o3_di" bpmnElement="Flow_1mxf3o3">
        <di:waypoint x="1340" y="120" />
        <di:waypoint x="1360" y="120" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="Flow_0w0aced_di" bpmnElement="Flow_0w0aced">
        <di:waypoint x="940" y="120" />
        <di:waypoint x="1040" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
